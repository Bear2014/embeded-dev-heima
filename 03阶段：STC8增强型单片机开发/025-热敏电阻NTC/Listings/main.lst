C51 COMPILER V9.60.7.0   MAIN                                                              04/26/2025 12:19:20 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\main
                    -.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #include "lib/STC8G_H_GPIO.h"
   2          #include "lib/STC8G_H_Delay.h"
   3          #include "lib/STC8G_H_UART.h"
   4          #include "lib/STC8G_H_Switch.h"
   5          #include "lib/STC8G_H_ADC.h"
   6          #include "lib/STC8G_H_NVIC.h"
   7          
   8          
   9          void GPIO_Config();
  10          void uart_Config();
  11          void ADC_Config();
  12          int search_temp_table(int);
  13          
  14          
  15          void main() {
  16   1          u16 adc_value;
  17   1          float v_res,o_res;
  18   1          int cur_temp;
  19   1      
  20   1          EA = 1;
  21   1          GPIO_Config();
  22   1        
  23   1          uart_Config();
  24   1        
  25   1          ADC_Config();
  26   1          
  27   1          printf("start...\n");
  28   1        
  29   1        
  30   1          while(1) {
  31   2            
  32   2            //1.»ñÈ¡P04Òý½ÅµÄ²âÁ¿Öµ
  33   2            adc_value = Get_ADCResult(ADC_CH12);
  34   2            printf("adc_value=%d\n",adc_value);
  35   2            
  36   2            //2.»»Ëã³ÉµçÑ¹
  37   2            v_res = adc_value * 2.5 / 4096;
  38   2            printf("v_res=%.2fv\n", v_res);
  39   2            
  40   2            /**
  41   2             * 3.¼ÆËãµç×è
  42   2             * ¹«Ê½£º´®ÁªµçÂ·£¬·ÖÑ¹
  43   2             *  3.3v - ntcµçÑ¹  ntcµçÑ¹
  44   2             *  ------------ = --------
  45   2             *      1Ok         ntcµç×è
  46   2             */
  47   2             o_res = v_res * 10 / (3.3 - v_res);
  48   2             printf("o_res=%.2fv\n", o_res);
  49   2             
  50   2             //4.×îºó¸ù¾ÝµÄµÃµ½µÄµç×è²é±í²é³öµ±Ç°µÄÎÂ¶È
  51   2            cur_temp = search_temp_table(o_res*100) - 55;
  52   2            printf("cur_temp=%d\n",cur_temp);
  53   2            
  54   2            delay_ms(250);
C51 COMPILER V9.60.7.0   MAIN                                                              04/26/2025 12:19:20 PAGE 2   

  55   2            delay_ms(250);
  56   2            delay_ms(250);
  57   2            delay_ms(250);
  58   2          }
  59   1        
  60   1      }
  61          
  62          
  63          
  64          //ÅäÖÃP04
  65          void GPIO_Config() {
  66   1        GPIO_InitTypeDef gpio_init;
  67   1        gpio_init.Mode = GPIO_HighZ; //ÉèÖÃÎª¸ß×èÊä³ö
  68   1        gpio_init.Pin = GPIO_Pin_4;
  69   1        GPIO_Inilize(GPIO_P0,&gpio_init);
  70   1      }
  71          
  72          
  73          
  74          //ÅäÖÃ´®¿Ú
  75          void uart_Config() {
  76   1          COMx_InitDefine   COMx_InitStructure;         //½á¹¹¶¨Òå
  77   1      
  78   1          COMx_InitStructure.UART_Mode      = UART_8bit_BRTx; //Ä£Ê½, UART_ShiftRight,UART_8bit_BRTx,UART_9bit,U
             -ART_9bit_BRTx
  79   1          COMx_InitStructure.UART_BRT_Use   = BRT_Timer1;     //Ñ¡Ôñ²¨ÌØÂÊ·¢ÉúÆ÷, BRT_Timer1, BRT_Timer2 (×¢Òâ: ´®
             -¿Ú2¹Ì¶¨Ê¹ÓÃBRT_Timer2)
  80   1          COMx_InitStructure.UART_BaudRate  = 115200ul;     //²¨ÌØÂÊ, Ò»°ã 110 ~ 115200
  81   1          COMx_InitStructure.UART_RxEnable  = ENABLE;       //½ÓÊÕÔÊÐí,   ENABLE»òDISABLE
  82   1          COMx_InitStructure.BaudRateDouble = DISABLE;      //²¨ÌØÂÊ¼Ó±¶, ENABLE»òDISABLE
  83   1          UART_Configuration(UART1, &COMx_InitStructure);   //³õÊ¼»¯´®¿Ú1 UART1,UART2,UART3,UART4
  84   1        
  85   1          NVIC_UART1_Init(ENABLE,Priority_1);   //ÖÐ¶ÏÊ¹ÄÜ, ENABLE\DISABLE; ÓÅÏÈ¼¶(µÍµ½¸ß) Priority_0,Priority_1,
             -Priority_2,Priority_3
  86   1          
  87   1          UART1_SW(UART1_SW_P30_P31);   //UART1_SW_P30_P31,UART1_SW_P36_P37,UART1_SW_P16_P17,UART1_SW_P43_P44
  88   1      }
  89          
  90          
  91          
  92          //ÅäÖÃADC
  93          void ADC_Config(){
  94   1        ADC_InitTypeDef adc_init;
  95   1        
  96   1        adc_init.ADC_SMPduty = 31;    //ADC Ä£ÄâÐÅºÅ²ÉÑùÊ±¼ä¿ØÖÆ, 0~31£¨×¢Òâ£º SMPDUTY Ò»¶¨²»ÄÜÉèÖÃÐ¡ÓÚ 10£©
  97   1        adc_init.ADC_Speed = ADC_SPEED_2X1T;      //ÉèÖÃ ADC ¹¤×÷Ê±ÖÓÆµÂÊ ADC_SPEED_2X1T~ADC_SPEED_2X16T
  98   1        
  99   1        //adc²É¼¯³öÀ´µÄÊý¾ÝÖ»ÓÐ12Î»£¬×°Õâ¸ö²É¼¯Êý¾Ý£¬²ÉÓÃ16Î»À´×°
 100   1        adc_init.ADC_AdjResult = ADC_RIGHT_JUSTIFIED; //ADC½á¹ûµ÷Õû,  ADC_LEFT_JUSTIFIED,ADC_RIGHT_JUSTIFIED
 101   1        adc_init.ADC_CsSetup = 0;   //ADC Í¨µÀÑ¡ÔñÊ±¼ä¿ØÖÆ 0(Ä¬ÈÏ),1
 102   1        adc_init.ADC_CsHold = 1;
 103   1        
 104   1        ADC_Inilize(&adc_init);
 105   1        
 106   1        //µçÔ´Ê¹ÓÃ
 107   1        ADC_PowerControl(ENABLE);
 108   1        
 109   1        //ÖÐ¶ÏÊ¹ÓÃ
 110   1        //NVIC_ADC_Init(DISABLE,Priority_1); //ÖÐ¶ÏÊ¹ÄÜ£¬Ò»°ã²»Ð´£¬Ð´ÁË»á¿´µ½²»Ò»ÑùµÄ½á¹û£¡£¡£¡£¡£¬ADC²»ÄÜ´ò¿ªÖÐ¶
             -Ï£¡£¡£¡
 111   1      }
 112          
C51 COMPILER V9.60.7.0   MAIN                                                              04/26/2025 12:19:20 PAGE 3   

 113          
 114          //ÅäÖÃÎÂ¶È±éÀú±í ¹Ø¼ü×Ö£ºcode xdata 
 115          u16 xdata temp_table[]= {
 116            58354, // -55
 117            55464, // -54
 118            52698, // -53
 119            50048, // -52
 120            47515, // -51
 121            45097, // -50
 122            42789, // -49
 123            40589, // -48
 124            38492, // -47
 125            36496, // -46
 126            34597, // -45
 127            32791, // -44
 128            31075, // -43
 129            29444, // -42
 130            27896, // -41
 131            26427, // -40
 132            25034, // -39
 133            23713, // -38
 134            22460, // -37
 135            21273, // -36
 136            20148, // -35
 137            19083, // -34
 138            18075, // -33
 139            17120, // -32
 140            16216, // -31
 141            15361, // -30
 142            14551, // -29
 143            13785, // -28
 144            13061, // -27
 145            12376, // -26
 146            11728, // -25
 147            11114, // -24
 148            10535, // -23
 149            9986,  // -22
 150            9468,  // -21
 151            8977,  // -20
 152            8513,  // -19
 153            8075,  // -18
 154            7660,  // -17
 155            7267,  // -16
 156            6896,  // -15
 157            6545,  // -14
 158            6212,  // -13
 159            5898,  // -12
 160            5601,  // -11
 161            5319,  // -10
 162            5053,  // -9
 163            4801,  // -8
 164            4562,  // -7
 165            4336,  // -6
 166            4122,  // -5
 167            3920,  // -4
 168            3728,  // -3
 169            3546,  // -2
 170            3374,  // -1
 171            3211,  // 0
 172            3057,  // 1
 173            2910,  // 2
 174            2771,  // 3
C51 COMPILER V9.60.7.0   MAIN                                                              04/26/2025 12:19:20 PAGE 4   

 175            2639,  // 4
 176            2515,  // 5
 177            2396,  // 6
 178            2284,  // 7
 179            2177,  // 8
 180            2076,  // 9
 181            1978,  // 10
 182            1889,  // 11
 183            1802,  // 12
 184            1720,  // 13
 185            1642,  // 14
 186            1568,  // 15
 187            1497,  // 16
 188            1430,  // 17
 189            1366,  // 18
 190            1306,  // 19
 191            1248,  // 20
 192            1193,  // 21
 193            1141,  // 22
 194            1092,  // 23
 195            1044,  // 24
 196            1000,  // 25
 197            957,   // 26
 198            916,   // 27
 199            877,   // 28
 200            840,   // 29
 201            805,   // 30
 202            771,   // 31
 203            739,   // 32
 204            709,   // 33
 205            679,   // 34
 206            652,   // 35
 207            625,   // 36
 208            600,   // 37
 209            576,   // 38
 210            552,   // 39
 211            530,   // 40
 212            509,   // 41
 213            489,   // 42
 214            470,   // 43
 215            452,   // 44
 216            434,   // 45
 217            417,   // 46
 218            401,   // 47
 219            386,   // 48
 220            371,   // 49
 221            358,   // 50
 222            344,   // 51
 223            331,   // 52
 224            318,   // 53
 225            306,   // 54
 226            295,   // 55
 227            284,   // 56
 228            274,   // 57
 229            264,   // 58
 230            254,   // 59
 231            245,   // 60
 232            236,   // 61
 233            228,   // 62
 234            220,   // 63
 235            212,   // 64
 236            205,   // 65
C51 COMPILER V9.60.7.0   MAIN                                                              04/26/2025 12:19:20 PAGE 5   

 237            198,   // 66
 238            191,   // 67
 239            184,   // 68
 240            178,   // 69
 241            172,   // 70
 242            166,   // 71
 243            160,   // 72
 244            155,   // 73
 245            150,   // 74
 246            145,   // 75
 247            140,   // 76
 248            135,   // 77
 249            131,   // 78
 250            126,   // 79
 251            122,   // 80
 252            118,   // 81
 253            115,   // 82
 254            111,   // 83
 255            107,   // 84
 256            104,   // 85
 257            101,   // 86
 258            97,    // 87
 259            94,    // 88
 260            91,    // 89
 261            89,    // 90
 262            86,    // 91
 263            83,    // 92
 264            81,    // 93
 265            78,    // 94
 266            76,    // 95
 267            74,    // 96
 268            71,    // 97
 269            69,    // 98
 270            67,    // 99
 271            65,    // 100
 272            63,    // 101
 273            61,    // 102
 274            60,    // 103
 275            58,    // 104
 276            56,    // 105
 277            55,    // 106
 278            53,    // 107
 279            52,    // 108
 280            50,    // 109
 281            49,    // 110
 282            47,    // 111
 283            46,    // 112
 284            45,    // 113
 285            43,    // 114
 286            42,    // 115
 287            41,    // 116
 288            40,    // 117
 289            39,    // 118
 290            38,    // 119
 291            37,    // 120
 292            36,    // 121
 293            35,    // 122
 294            34,    // 123
 295            33,    // 124
 296            32,    // 125
 297          };
 298          
C51 COMPILER V9.60.7.0   MAIN                                                              04/26/2025 12:19:20 PAGE 6   

 299          
 300          //¼ì²éÎÂ¶È±í
 301          int search_temp_table(res_RX10) {
 302   1        int i,min_index=0;
 303   1        float current_abs=0.00;
 304   1        
 305   1        int len = sizeof(temp_table) / sizeof(u16);
 306   1        
 307   1        float min_abs = abs(res_RX10 - temp_table[0]);
 308   1        for(i=1;i<len;i++) {
 309   2          float current_abs = abs(res_RX10 - temp_table[i]);
 310   2          if(min_abs > current_abs) {
 311   3             min_abs = current_abs;
 312   3             min_index = i;
 313   3          } 
 314   2        }
 315   1        
 316   1        return min_index;
 317   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    519    ----
   CONSTANT SIZE    =     63    ----
   XDATA SIZE       =    362    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      48
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
