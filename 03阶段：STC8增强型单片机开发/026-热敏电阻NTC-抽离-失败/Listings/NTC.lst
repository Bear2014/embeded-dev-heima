C51 COMPILER V9.60.7.0   NTC                                                               04/25/2025 21:34:01 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE NTC
OBJECT MODULE PLACED IN .\Objects\NTC.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE NTC.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\NTC.l
                    -st) TABS(2) OBJECT(.\Objects\NTC.obj)

line level    source

   1          #include "NTC.h"
   2          
   3          #include "lib/STC8G_H_GPIO.h"
   4          #include "lib/STC8G_H_ADC.h"
   5          #include "lib/STC8G_H_NVIC.h"
   6          
   7          
   8          //ÅäÖÃP04
   9          void GPIO_Config() {
  10   1        GPIO_InitTypeDef gpio_init;
  11   1        gpio_init.Mode = GPIO_HighZ; //ÉèÖÃÎª¸ß×èÊä³ö
  12   1        gpio_init.Pin = GPIO_Pin_4;
  13   1        GPIO_Inilize(GPIO_P0,&gpio_init);
  14   1      }
  15          
  16          
  17          //ÅäÖÃADC
  18          void ADC_Config(){
  19   1        ADC_InitTypeDef adc_init;
  20   1        
  21   1        adc_init.ADC_SMPduty = 31;    //ADC Ä£ÄâÐÅºÅ²ÉÑùÊ±¼ä¿ØÖÆ, 0~31£¨×¢Òâ£º SMPDUTY Ò»¶¨²»ÄÜÉèÖÃÐ¡ÓÚ 10£©
  22   1        adc_init.ADC_Speed = ADC_SPEED_2X1T;      //ÉèÖÃ ADC ¹¤×÷Ê±ÖÓÆµÂÊ ADC_SPEED_2X1T~ADC_SPEED_2X16T
  23   1        
  24   1        //adc²É¼¯³öÀ´µÄÊý¾ÝÖ»ÓÐ12Î»£¬×°Õâ¸ö²É¼¯Êý¾Ý£¬²ÉÓÃ16Î»À´×°
  25   1        adc_init.ADC_AdjResult = ADC_RIGHT_JUSTIFIED; //ADC½á¹ûµ÷Õû,  ADC_LEFT_JUSTIFIED,ADC_RIGHT_JUSTIFIED
  26   1        adc_init.ADC_CsSetup = 0;   //ADC Í¨µÀÑ¡ÔñÊ±¼ä¿ØÖÆ 0(Ä¬ÈÏ),1
  27   1        adc_init.ADC_CsHold = 1;
  28   1        
  29   1        ADC_Inilize(&adc_init);
  30   1        
  31   1        //µçÔ´Ê¹ÓÃ
  32   1        ADC_PowerControl(ENABLE);
  33   1        
  34   1        //ÖÐ¶ÏÊ¹ÓÃ
  35   1        NVIC_ADC_Init(DISABLE,Priority_1); //ÖÐ¶ÏÊ¹ÄÜ£¬Ò»°ã²»Ð´£¬Ð´ÁË»á¿´µ½²»Ò»ÑùµÄ½á¹û£¡£¡£¡£¡£¬ADC²»ÄÜ´ò¿ªÖÐ¶Ï£
             -¡£¡£¡
  36   1      }
  37          
  38          
  39          void NTC_Init() {
  40   1          EA = 1;
  41   1          GPIO_Config();
  42   1        
  43   1          ADC_Config();
  44   1      }
  45          
  46          //ÅäÖÃÎÂ¶È±éÀú±í ¹Ø¼ü×Ö£ºcode xdata 
  47          u16 xdata temp_table[]= {
  48            58354, // -55
  49            55464, // -54
  50            52698, // -53
  51            50048, // -52
  52            47515, // -51
  53            45097, // -50
C51 COMPILER V9.60.7.0   NTC                                                               04/25/2025 21:34:01 PAGE 2   

  54            42789, // -49
  55            40589, // -48
  56            38492, // -47
  57            36496, // -46
  58            34597, // -45
  59            32791, // -44
  60            31075, // -43
  61            29444, // -42
  62            27896, // -41
  63            26427, // -40
  64            25034, // -39
  65            23713, // -38
  66            22460, // -37
  67            21273, // -36
  68            20148, // -35
  69            19083, // -34
  70            18075, // -33
  71            17120, // -32
  72            16216, // -31
  73            15361, // -30
  74            14551, // -29
  75            13785, // -28
  76            13061, // -27
  77            12376, // -26
  78            11728, // -25
  79            11114, // -24
  80            10535, // -23
  81            9986,  // -22
  82            9468,  // -21
  83            8977,  // -20
  84            8513,  // -19
  85            8075,  // -18
  86            7660,  // -17
  87            7267,  // -16
  88            6896,  // -15
  89            6545,  // -14
  90            6212,  // -13
  91            5898,  // -12
  92            5601,  // -11
  93            5319,  // -10
  94            5053,  // -9
  95            4801,  // -8
  96            4562,  // -7
  97            4336,  // -6
  98            4122,  // -5
  99            3920,  // -4
 100            3728,  // -3
 101            3546,  // -2
 102            3374,  // -1
 103            3211,  // 0
 104            3057,  // 1
 105            2910,  // 2
 106            2771,  // 3
 107            2639,  // 4
 108            2515,  // 5
 109            2396,  // 6
 110            2284,  // 7
 111            2177,  // 8
 112            2076,  // 9
 113            1978,  // 10
 114            1889,  // 11
 115            1802,  // 12
C51 COMPILER V9.60.7.0   NTC                                                               04/25/2025 21:34:01 PAGE 3   

 116            1720,  // 13
 117            1642,  // 14
 118            1568,  // 15
 119            1497,  // 16
 120            1430,  // 17
 121            1366,  // 18
 122            1306,  // 19
 123            1248,  // 20
 124            1193,  // 21
 125            1141,  // 22
 126            1092,  // 23
 127            1044,  // 24
 128            1000,  // 25
 129            957,   // 26
 130            916,   // 27
 131            877,   // 28
 132            840,   // 29
 133            805,   // 30
 134            771,   // 31
 135            739,   // 32
 136            709,   // 33
 137            679,   // 34
 138            652,   // 35
 139            625,   // 36
 140            600,   // 37
 141            576,   // 38
 142            552,   // 39
 143            530,   // 40
 144            509,   // 41
 145            489,   // 42
 146            470,   // 43
 147            452,   // 44
 148            434,   // 45
 149            417,   // 46
 150            401,   // 47
 151            386,   // 48
 152            371,   // 49
 153            358,   // 50
 154            344,   // 51
 155            331,   // 52
 156            318,   // 53
 157            306,   // 54
 158            295,   // 55
 159            284,   // 56
 160            274,   // 57
 161            264,   // 58
 162            254,   // 59
 163            245,   // 60
 164            236,   // 61
 165            228,   // 62
 166            220,   // 63
 167            212,   // 64
 168            205,   // 65
 169            198,   // 66
 170            191,   // 67
 171            184,   // 68
 172            178,   // 69
 173            172,   // 70
 174            166,   // 71
 175            160,   // 72
 176            155,   // 73
 177            150,   // 74
C51 COMPILER V9.60.7.0   NTC                                                               04/25/2025 21:34:01 PAGE 4   

 178            145,   // 75
 179            140,   // 76
 180            135,   // 77
 181            131,   // 78
 182            126,   // 79
 183            122,   // 80
 184            118,   // 81
 185            115,   // 82
 186            111,   // 83
 187            107,   // 84
 188            104,   // 85
 189            101,   // 86
 190            97,    // 87
 191            94,    // 88
 192            91,    // 89
 193            89,    // 90
 194            86,    // 91
 195            83,    // 92
 196            81,    // 93
 197            78,    // 94
 198            76,    // 95
 199            74,    // 96
 200            71,    // 97
 201            69,    // 98
 202            67,    // 99
 203            65,    // 100
 204            63,    // 101
 205            61,    // 102
 206            60,    // 103
 207            58,    // 104
 208            56,    // 105
 209            55,    // 106
 210            53,    // 107
 211            52,    // 108
 212            50,    // 109
 213            49,    // 110
 214            47,    // 111
 215            46,    // 112
 216            45,    // 113
 217            43,    // 114
 218            42,    // 115
 219            41,    // 116
 220            40,    // 117
 221            39,    // 118
 222            38,    // 119
 223            37,    // 120
 224            36,    // 121
 225            35,    // 122
 226            34,    // 123
 227            33,    // 124
 228            32,    // 125
 229          };
 230          
 231          
 232          //¼ì²éÎÂ¶È±í
 233          int search_temp_table(res_RX10) {
 234   1        int i,min_index = 0;
 235   1        float current_abs = 0.00;
 236   1        
 237   1        int len = sizeof(temp_table) / sizeof(u16);
 238   1        
 239   1        float min_abs = abs(res_RX10 - temp_table[0]);
C51 COMPILER V9.60.7.0   NTC                                                               04/25/2025 21:34:01 PAGE 5   

 240   1        for(i=1;i<len;i++) {
 241   2          float current_abs = abs(res_RX10 - temp_table[i]);
 242   2          if(min_abs > current_abs) {
 243   3             min_abs = current_abs;
 244   3             min_index = i;
 245   3          } 
 246   2        }
 247   1        
 248   1        return min_index;
 249   1      }
 250          
 251          
 252          //»ñÈ¡ÎÂ¶È
 253          int NTC_get_temp() {
 254   1          u16 adc_value;
 255   1          float v_res,o_res;
 256   1       
 257   1          //1.»ñÈ¡P04Òý½ÅµÄ²âÁ¿Öµ
 258   1          adc_value = Get_ADCResult(ADC_CH12);
 259   1            
 260   1          //2.»»Ëã³ÉµçÑ¹
 261   1          v_res = adc_value * 2.5 / 4096;
 262   1            
 263   1          /**
 264   1           * 3.¼ÆËãµç×è
 265   1           * ¹«Ê½£º´®ÁªµçÂ·£¬·ÖÑ¹
 266   1           *  3.3v - ntcµçÑ¹  ntcµçÑ¹
 267   1           *  ------------ = --------
 268   1           *      1Ok         ntcµç×è
 269   1           */
 270   1          o_res = v_res * 10 / (3.3 - v_res);
 271   1             
 272   1          //4.×îºó¸ù¾ÝµÄµÃµ½µÄµç×è²é±í²é³öµ±Ç°µÄÎÂ¶È
 273   1          return search_temp_table(o_res*100) - 55; 
 274   1      }
 275          
 276          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    378    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =    362    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----      35
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
